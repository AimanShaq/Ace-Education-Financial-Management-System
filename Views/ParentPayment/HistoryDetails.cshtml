@model Ace_Tuition_WBL.Models.tbReceipt

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_LayoutParent.cshtml";
    var subtotal = ViewData["subtotal"];
    var early = ViewData["early"];
    var earlycc = ViewData["earlycc"];

}



<div class="row">
    <div class="col-2"></div>
    <div class="card col-8">
        <div class="card-header">
            <h1 class="card-title, text-center">Payment Detail</h1>
        </div>
        <div class="card-body">
            <h5><strong>Parent Name:</strong> @Html.DisplayFor(model => model.tbStudent.tbParent.ParentName)</h5>
            <h5><strong>Parent IC:</strong> @Html.DisplayFor(model => model.tbStudent.tbParent.ParentIC)</h5>
            <h5><strong>Student Name:</strong> @Html.DisplayFor(model => model.tbStudent.StudentName)</h5>
            <h5><strong>Student IC:</strong> @Html.DisplayFor(model => model.tbStudent.StudentIC)</h5>
            <h5><strong>Student Category:</strong> @Html.DisplayFor(model => model.tbStudent.tbCategory.CatDesc)</h5>
            <br />
            <table id="example1" class="table table-flush table-striped table-hover">
                <colgroup>
                    <col span="1" style="width: 85%;">
                    <col span="1" style="width: 15%;">
                </colgroup>
                <thead>

                    <tr>
                        <th>Item</th>
                        <th style=" text-align: center">Total (RM)</th>
                    </tr>
                </thead>
                <tbody>
                    @*First Registration Fee*@
                    @if (Model.firstReg == 1)
                    {
                        <tr>
                            <td style="font-size:large">Registration Fee</td>
                            <td class="text-center" style="font-size:large">30.00</td>
                        </tr>
                    }
                    @*Tuition Fee*@
                    <tr>
                        <td style="font-size:large">Tuition Fee ( @Html.DisplayFor(model => model.tbStudent.subjCount) Subjects )</td>
                        <td class="text-center" style="font-size:large">
                            @if (Model.tbStudent.StudentCat == 1)
                            {
                                foreach (var item in Model.tbStudent.tbCategory.tbPrimaries.ToList())
                                {
                                    if (Model.tbStudent.subjCount == item.PrimaryID)
                                    {
                                        @String.Format("{0:0.00}", item.PrimaryFee)
                                    }
                                }
                            }
                            @if (Model.tbStudent.StudentCat == 2)
                            {
                                foreach (var item in Model.tbStudent.tbCategory.tbSecondaries.ToList())
                                {
                                    if (Model.tbStudent.subjCount == item.SecondaryID)
                                    {
                                        @String.Format("{0:0.00}", item.SecondaryFee)
                                    }

                                }
                            }
                        </td>
                    </tr>
                    @*Material Fee*@
                    <tr>
                        <td style="font-size:large">Material Fee</td>
                        <td class="text-center" style="font-size:large">
                            @if (Model.tbStudent.StudentCat == 1)
                            {
                                foreach (var item in Model.tbStudent.tbCategory.tbPrimaries.ToList())
                                {
                                    if (Model.tbStudent.subjCount == item.PrimaryID)
                                    {
                                        @String.Format("{0:0.00}", item.PrimaryMaterial)
                                    }
                                }
                            }
                            @if (Model.tbStudent.StudentCat == 2)
                            {
                                foreach (var item in Model.tbStudent.tbCategory.tbSecondaries.ToList())
                                {
                                    if (Model.tbStudent.subjCount == item.SecondaryID)
                                    {
                                        @String.Format("{0:0.00}", item.SecondaryMaterial)
                                    }
                                }
                            }
                        </td>
                    </tr>
                    @*Childcare Fee*@
                    @if (Model.tbStudent.ccStat != 0)
                    {
                        <tr>
                            <td style="font-size:large">Childcare</td>
                            <td class="text-center" style="font-size:large">
                                @String.Format("{0:0.00}", Model.tbStudent.tbPackage.PackageFee)
                            </td>
                        </tr>
                    }
                    @*Meal Fee*@
                    @if (Model.tbStudent.mealStat != 0)
                    {
                        <tr>
                            <td style="font-size:large">Meal Fee</td>
                            <td class="text-center" style="font-size:large">
                                @String.Format("{0:0.00}", Model.tbStudent.tbPackage1.PackageFee)
                            </td>
                        </tr>
                    }
                    @*Writing Fee*@
                    @if (Model.tbStudent.writingStat != 0)
                    {
                        <tr>
                            <td style="font-size:large">Writing Fee</td>
                            <td class="text-center" style="font-size:large">
                                @String.Format("{0:0.00}", Model.tbStudent.tbPackage2.PackageFee)
                            </td>
                        </tr>
                    }
                    @*Transport Fee*@
                    @if (Model.tbStudent.transDPW != 0)
                    {
                        <tr>
                            <td style="font-size:large">Transport</td>
                            <td class="text-center" style="font-size:large">
                                @String.Format("{0:0.00}", Model.tbStudent.tbTransport.transFee)
                            </td>
                        </tr>
                    }

                    @*Subtotal*@
                    <tr>
                        <td class="text-right" style="font-size:large"><strong>Subtotal (RM): </strong></td>
                        <td class="text-center" style="font-size:large">@String.Format("{0:0.00}", subtotal)</td>
                    </tr>
                    @*B40 Discount Fee*@
                    @if (Model.tbStudent.tbParent.B40Status != 0)
                    {
                        <tr>
                            <td class="text-right" style="font-size:large"><strong>Discount: </strong></td>
                            <td class="text-center" style="font-size:large">
                                - @Html.DisplayFor(model => model.tbStudent.tbParent.B40Status) %
                            </td>
                        </tr>
                    }
                    @*Early Payment Fee*@
                    @if (Model.earlyPay == 1)
                    {
                        <tr>
                            <td class="text-right" style="font-size:large">
                                <p><strong>Early Pay Discount: </strong></p>
                            </td>
                            <td class="text-center" style="font-size:large">

                                @if (Model.tbStudent.ccStat == 0)
                                {
                                    <p>- @String.Format("{0:0.00}", early) </p>

                                }
                                else
                                {
                                    <p>- @String.Format("{0:0.00}", earlycc) </p>
                                }

                            </td>
                        </tr>
                    }
                    @*Sibling Discount Fee*@
                    @if (Model.tbStudent.tbParent.siblingCount > 1)
                    {
                        <tr>
                            <td class="text-right">
                                <strong>Sibling Discount: </strong>
                            </td>
                            <td class="text-center"> - 5% </td>
                        </tr>
                    }


                    @* Total Fee *@
                    <tr>
                        <td class="text-right" style="font-size:x-large"><strong>Total (RM): </strong></td>
                        <td class="text-center" style="font-size:x-large"> @String.Format("{0:0.00}", Model.ReceiptTotal)</td>
                    </tr>

                    @*Amount have Pay*@
                    @if (Model.ReceiptAmount != null)
                    {
                        <tr>
                            <td class="text-right" style="font-size:x-large; color:green;"><strong>Paid (RM): </strong></td>
                            <td class="text-center" style="font-size:x-large; color:green;">
                                @String.Format("{0:0.00}", Model.ReceiptAmount)
                            </td>
                        </tr>
                    }
                    @*Amount need to Pay*@
                    @if (Model.ReceiptOutstanding == 1)
                    {
                        <tr>
                            <td class="text-right" style="font-size:x-large; color:red;"><strong>Outstanding (RM): </strong></td>
                            <td class="text-center" style="font-size:x-large; color:red;">
                                @foreach (var item in Model.tbStudent.tbOutstandings.ToList())
                                {
                                    if (item.StudentID == Model.tbStudent.StudentID)
                                    {
                                        @String.Format("{0:0.00}", item.OutFee);
                                    }
                                }
                            </td>
                        </tr>
                    }
                    @if (Model.ReceiptAmount == null)
                    {
                        <tr>
                            <td class="text-right" style="font-size:x-large; color:red;"><strong>Outstanding (RM): </strong></td>
                            <td class="text-center" style="font-size:x-large; color:red;">
                                @String.Format("{0:0.00}", Model.ReceiptTotal)
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <br />
            @if (Model.ReceiptProof != null)
            {
                <div class="row">
                    <h5 class="col-10"><strong>Payment Proof:</strong> @Html.DisplayFor(model => model.ReceiptProof)</h5>
                    <a href="@Url.Content(Model.ReceiptProof)" class="btn btn-success" download><span class="fa fa-download"> </span> Download Proof</a>
                </div>
            }
            else
            {
                <h5 style="font-weight:bold; color: red"><strong>Payment Proof Has not been Uploaded</strong></h5>
            }

            @if (Model.ReceiptStatus == 0)
            {
                <h5><strong>Payment Status:</strong> Outstanding</h5>
            }
            else if (Model.ReceiptStatus == 1)
            {
                <h5><strong>Payment Status:</strong> Pending Appoval</h5>
            }
            else if (Model.ReceiptStatus == 2)
            {
                <h5><strong>Payment Status:</strong> Accepted</h5>
            }
            else
            {
                <h5><strong>Payment Status:</strong> Rejected</h5>
            }

        </div>
        <div class="card-footer">
            @if (Model.ReceiptStatus != 2)
            {
                @Html.ActionLink("Edit", "Edit", new { id = Model.ReceiptID }, new { @class = "btn btn-success" })
            }
            @Html.ActionLink("Back to List", "Index", null, new { @class = "btn btn-info" })
        </div>

    </div>
</div>
<script>
    $(function () {
        $("#example1").DataTable({

            "ordering": false,
            "responsive": true,
            "lengthChange": false,
            "autoWidth": false,

            "buttons": [{
                extend: 'print',
                text: '<span class="fa fa-print"> </span> Print Receipt',
                title: '<br><br><strong>Receipt ID:</strong> @Model.ReceiptID <br> <strong>ParentName:</strong> @Model.tbStudent.tbParent.ParentName <br> <strong>Parent IC:</strong> @Model.tbStudent.tbParent.ParentIC <br><strong> Student Name:</strong> @Model.tbStudent.StudentName <br><strong> Student IC:</strong> @Model.tbStudent.StudentIC <br><strong> Student Category:</strong> @Model.tbStudent.tbCategory.CatDesc <br><br>',
                autoPrint: true,

                customize:
                function (win) {
                    $(win.document.body)
                        .css('font-size', '18pt')
                        .prepend(
                            '<img src="https://i.ibb.co/c652f0D/acedu2.png" style="position:absolute; top:10%; left:15%; opacity:0.3; width: auto; height:50%" />'
                        );

                    $(win.document.body).find('table')
                        .addClass('bordered')
                        .css('font-size', 'inherit')
                        .css('font-family', 'Times New Roman');


                    $(win.document.body).find('h1').css('font-size', '15pt');
                    $(win.document.body).find('h1').css('text-align', 'left');
                    $(win.document.body).find('h1').css('font-family', 'Times New Roman');


                    }

            }],
            "searching": false,
            "paging": false,
            "bInfo": false
        }).buttons().container().appendTo('#example1_wrapper .col-md-7:eq(0)');
        $('#example2').DataTable({
            "paging": true,
            "lengthChange": false,
            "searching": false,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "responsive": true,
        });
    });
</script>